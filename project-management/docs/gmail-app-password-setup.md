# Gmail App Password Setup Guide

This guide explains how to create and use an App Password for the Health Management App's password reset email functionality.

## What is an App Password?

An App Password is a 16-character password generated by Google that allows applications to send emails using your Gmail account. This is different from your regular Gmail password.

## Prerequisites

- Gmail account
- 2-Factor Authentication (2FA) enabled on Google Account
- Access to Gmail via web browser

## Step 1: Enable 2-Factor Authentication (If Not Enabled)

If you don't have 2FA enabled:

1. Go to [Google Account Security](https://myaccount.google.com/security)
2. Under "Signing in to Google", click **2-Step Verification**
3. Click "Get Started" button
4. Choose verification method (SMS or authenticator app)
5. Follow the prompts to enable 2FA

## Step 2: Generate App Password

### 2.1 Access Google Account Security Settings

1. Go to [Google Account Security](https://myaccount.google.com/security)
2. Scroll to "How you sign in to Google" section
3. Click **2-Step Verification** if you see it (or go to this section directly)

### 2.2 Access App Passwords Section

1. Look for section titled **App passwords**
2. Click on the arrow (>) to expand the section

### 2.3 Generate New App Password

1. Click **Select app** dropdown menu
2. Choose **Mail** (for sending password reset emails)
3. Click the **Select device** dropdown menu
4. Enter device name (e.g., "Health Management App Android")
5. Click **Generate** button

### 2.4 Copy the App Password

**Important**: Copy the generated password immediately. You won't be able to see it again!

The password will be 16 characters and look something like:
```
abcd efgh ijkl mnop qrst uvwx
```

**Save this password in a secure location** (password manager, encrypted notes, etc.)

## Step 3: Verify the App Password (Optional)

To verify the password works:

1. Compose a new email in Gmail
2. Enter the generated app password in the password field (when prompted)
3. Send the test email
4. Verify the email sends successfully

If Gmail asks for your regular password, click "Use app password" instead.

## Step 4: Configure Backend

### 4.1 Update Backend .env File

In `backend/api/.env` file, set:

```bash
SMTP_USERNAME=your-email@gmail.com
SMTP_PASSWORD=your-16-character-app-password-here
```

Replace:
- `your-email@gmail.com` with your actual Gmail address
- `your-16-character-app-password-here` with the app password you generated

### 4.2 Restart Backend

After updating `.env`, restart your backend:

```bash
# If using PHP-FPM (common on shared hosting)
php-fpm restart

# If using Apache (common on shared hosting)
service apache2 restart

# If using custom deployment script
./deploy-dreamhost.sh
```

## Step 5: Test Password Reset Flow

### 5.1 Test Password Reset Request

```bash
# Request password reset for your email
curl -X POST https://health.martinfourier.com/api/v1/auth/password-reset/request \
  -H "Content-Type: application/json" \
  -d '{
    "email": "your-email@gmail.com"
  }'
```

Expected response:
```json
{
  "status": "success",
  "data": [],
  "message": "Password reset link sent"
}
```

Check your Gmail inbox for the password reset email. It should arrive within 1-2 minutes.

### 5.2 Complete Password Reset

1. Click the password reset link in the email
2. Enter new password
3. Confirm password
4. Try logging in with new password

## Security Notes

### Do's and Don'ts

✅ **DO:**
- Do use app passwords in your regular Gmail login (use them only for application access)
- Store the app password securely (password manager, encrypted notes)
- Generate a different app password for each application
- Use a password manager to avoid forgetting app passwords

❌ **DON'T:**
- Don't share the app password
- Don't use the app password for any other purpose
- Don't reuse the app password for multiple applications
- Don't write down the app password in plain text

### Best Practices

1. **Unique per Application**: Generate a separate app password for each app that needs email access
2. **Regular Rotation**: Change app passwords every 6-12 months for security
3. **Strong Password**: Use a password manager to generate strong, random passwords
4. **Two-Factor**: Keep 2FA enabled for account security
5. **Revocation**: If you suspect an app password is compromised, revoke it immediately

## Troubleshooting

### Error: "Authentication failed" or "Invalid credentials"

**Possible causes**:
1. App password not generated correctly
2. App password not saved in `.env` file
3. App password has spaces or special characters (copy carefully)
4. 2FA not enabled on account

**Solutions**:
1. Generate a new app password and update `.env`
2. Verify app password is 16 characters (no spaces)
3. Check 2FA is enabled on your Google Account
4. Restart backend service

### Error: Email not being sent

**Possible causes**:
1. SMTP settings incorrect in `.env`
2. App password not working
3. Gmail blocking the email
4. Firewall blocking outbound port 587

**Solutions**:
1. Verify `SMTP_USERNAME` and `SMTP_PASSWORD` in `.env`
2. Test app password by logging into Gmail with it
3. Check Gmail SMTP is not blocking app passwords
4. Contact DreamHost support if issue persists

### Error: "550 5.7.0 Relaying not permitted"

**Cause**: DreamHost SMTP server is blocking relays

**Solution**:
1. Contact DreamHost support to enable SMTP relay for your account
2. Check SMTP authentication requirements

### Revoke Compromised App Password

If you suspect an app password has been compromised:

1. Go to [Google Account Security > App Passwords](https://myaccount.google.com/apppasswords)
2. Find the app password you want to revoke
3. Click "Revoke" button
4. Generate a new app password
5. Update `.env` file with new password

## Files to Update

- `backend/api/.env` - Add `SMTP_USERNAME` and `SMTP_PASSWORD`

## References

- [Gmail Help: App Passwords](https://support.google.com/accounts/answer/185833?hl=en)
- [Gmail SMTP Settings](https://support.google.com/mail/answer/7127429?hl=en)

---

**Last Updated**: 2026-01-04
